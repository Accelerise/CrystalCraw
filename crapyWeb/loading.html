<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Loading Page</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<script src="js/jquery-3.2.1.min.js"></script>
	<style type="text/css">
	body{
		overflow-x: hidden;
	}
		*{
			padding: 0px;
			margin: 0px;
		}
		.back{
			background-color: rgb(28, 39, 42);
			width: 100%;
			height: 100%;
		}
		.top{
			height: 356px;
			width: 100%;
		}
		.img{
			height: 356px;
		}
		.showTest{
			height: 356px;
			/* line-height: 356px; */
			color: rgb(213, 221, 226);
			padding-top: 100px;
		}
		.Lheight{
			/* line-height: 356px; */
		}
		.stopBtn{
			position: fixed;
			top: 0;
			right: 0;
		}
		.move{
			margin-top: 50px;
			transition: left 0.3s;
			background-color: #666666;
			padding: 50px;
			position: absolute;
			border-radius: 5px;
			font-size: 20px;
			color: white;
			word-wrap:break-word; 
			word-break:break-all; 
		}
		.middle{
			height: 50px;
			border-top: 1px solid #cccccc;
			color: white;
		}
	</style>
</head>
<body id="body">
	<button class="btn btn-danger stopBtn">停止并获取结果</button>
<!-- <button class="btn btn-danger" id="test">test</button> -->
	<div class="back">
		<div class="container">
			<div class="col-sm-6">
				<img src="./img/loading.gif">
			</div>	
			<div class="showTest col-sm-6 ">
				<h1 class=" Lheight text-center ">
					<p>已收集<span id="number">0</span>个网页</p>
					<p>已爬取<span id="dataNumber">0</span>个详情页</p>
				</h1>
			</div>

			<div class="middle col-sm-12">
				<div class="center-block" style="width: 30px">
					详情
					<span class="glyphicon glyphicon-chevron-down" style="font-size: 30px"></span>
				</div>
			</div>
		</div>
		<div class="xia">
			
		</div>	
	</div>

	<script type="text/javascript">
		//获取爬取数量与数据
		var getAjax = {};

		var data = {
			"easdas":"Dasda",
			"easda2s":"DasdaDasda",
			"easda23s":"DasdaDasdaDasda",
			"easda23seasda23seasda23s":"DasdaDasdaDasdaDasdaDasdaDasdaDasdaDasdaDasda"
		};
		 function getNumber(){
			$.ajax({
				url: '/getNumber', //获取以爬取数量
				type: 'GET',  //随意修改此选项
				dataType: 'json', //返回json数据结构 {'number'：***}
				timeout:500, //设置超时限制 以防网络不好
				success:function(data){
					if(typeof data === String)
						data = JSON.parse(data);
					$('#number').text(data.number);
					$('#dataNumber').text(data.dataNumber);
				},
				error:function(xhr,status,error){
					console.error(xhr);
					console.error(status);
					console.error(data);
				}
			});
		}
		 function getData(message){
			$.ajax({
				url: '/getData', //获取以爬取数量
				type: 'POST',  //随意修改此选项
				dataType: 'json', //返回json数据结构 {'number'：***}
				timeout:2000, //设置超时限制 以防网络不好
				data:message,
				success:function(data){
					if(typeof data === String)
						data = JSON.parse(data);
					if(data === null || data === {} || data === undefined)
					{
						
						return ;
					}
					show(data);
				},
				error:function(xhr,status,error){
					console.error(xhr);
					console.error(status);
					console.error(data);
				}
			});
		}

		function show(data){
			var div  = document.createElement("div");
			var divList = $("div.move");
			var length =  divList.length;
			for(var i = 0 ; i<length;i++)
			{
				var curLeft = $(divList[i]).css('left');
				//alert(curLeft);
				$(divList[i]).css('left', parseInt(curLeft)+($(window).width())/3 +10+ 'px');
			}
			for(i = 0 ; i<length;i++)
			{				 
				if(parseInt($(divList[i]).css('left')) > $(window).width())
				{
					$(divList[i]).remove();
				}
				else {
					break;
				}
			}
			$(div).addClass('move');
			$(div).width(($(window).width()-100)/3);
			$(div).css('left', '-'+ $(window).width()/3 + 'px');
			var test = "";
			for(var key in data){
				 test += '<p>'+key +':' +data[key]+'</p>';
			}
			$(div).html(test);
			$("div.xia").append(div);
			
		}
		//网页加载完成后	
		$(document).ready(function() {
			curHeight = $(window).height();
			$("#body").height(Number(curHeight) > 906?curHeight:"906px"); // 设置页面高度
			if(Number($(window).width()) < 1200)
			{
				$("div.img").hide("1");
			}
			setInterval(function(){show(data);},2000); // 每2s获取一次数据
			//setInterval(function(){getNumber();},500); // 每0.5s查询一次数量
		});
		//点击按钮后
		$("button.stopBtn").click(function(event) {
			//此处应有发送停止指令给后台
			//
			$.ajax({
				url: '/path/to/file',
				type: 'default GET (Other values: POST)',
				dataType: 'default: Intelligent Guess (Other values: xml, json, script, or html)',
				data: {param1: 'value1'},
				success:function(){
					location.href = "results.html"; //发送成功变跳转到结果页面
				},
				error:function(xhr,status,error){
					console.error(xhr);
					console.error(status);
					console.error(data);
				}
			});
			
		});


		$("#test").click(function() {
			show();
		});
	</script>
</body>
</html>