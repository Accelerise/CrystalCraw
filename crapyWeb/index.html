<!DOCTYPE html>
<html>
<head>
	<title>Crapy Web</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<script src="js/jquery-3.2.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.validate.min.js"></script>
	<style type="text/css">
	.alertHidden{
		display: none
	}
	.error{
		color: #FF6666
	}
	.showDiv{
		font-size: 20px;
		height: 89px;
		line-height: 49px;
		border: 1px solid #cccccc;
		padding: 20px;
		width: 290px;
		display: none;
	}
	</style>
</head>
<body>
	<header class="container">
		<div class="page-header">
			<h1>Welcome To Automatic crawler
				<small>Input the message in the form and submit</small>
			</h1>
		</div>
	</header>	

	<div class="container formDiv" >
		<form class="form-horizontal" role="form" id="mainForm">
			<div class="form-group">
				<label for="mainUrl" class=" col-sm-2 control-label"> THE MAIN URL</label>
				<div class="col-sm-8">
					<input type="text" name="mainUrl" id="mainUrl" class="form-control" placeholder="Please input the URL">				
				</div>
			</div>
			<div class="form-group ">
				<label for="dataUrl1" class=" col-sm-2 control-label"> THE DATA URL 1</label>
				<div class="col-sm-8">
					<input type="text" name="dataUrl1" id="dataUrl1" class="form-control" placeholder="Please input the URL">				
				</div>
			</div>
				<div class="form-group " id = "Btn2">
				<div class="col-sm-offset-2 col-sm-8">
					<button class="btn btn-default btn-md" id="addUrl" type="button">
						<span class="glyphicon glyphicon-plus"></span>
					</button>
					<button class="btn btn-default btn-md" id="cutUrl" type="button">
						<span class="glyphicon glyphicon-minus"></span>
					</button>
				</div>					
			</div>
			<div class="form-group ">
				<label for="attName0" class=" col-sm-2 control-label"> ATTRIBUTE1 NAME</label>
				<div class="col-sm-2">
					<input type="text" name="attName0" id="attName0" class="form-control" placeholder="Please input the attribute">				
				</div>
				<label for="Xpath0" class="col-sm-1 control-label"> XPath1 </label>
				<div class="col-sm-5">
					<input type="text" name="Xpath0" id="Xpath0" class="form-control" placeholder="Please input the XPath">				
				</div>
			</div>
			<div class="form-group " id = "Btn">
				<div class="col-sm-offset-2 col-sm-8">
					<button class="btn btn-default btn-md" id="addAttr" type="button">
						<span class="glyphicon glyphicon-plus"></span>
					</button>
					<button class="btn btn-default btn-md" id="cutAttr" type="button">
						<span class="glyphicon glyphicon-minus"></span>
					</button>
				</div>					
			</div>
			
			<hr>
			<div class="form-group">
				<div class="col-sm-offset-2 col-sm-8">
					<button class="btn btn-default" type="submit" id="subBtn">SUBMIT</button>
				</div>
			</div>

			<div class="container">
				<div class="alert alert-success  alertHidden col-sm-10 ">
   					<button type="button" class="close">&times;</button>
   					SUBMIT SUCCESS!
  				</div>
  				<div class="alert alert-warning  alertHidden col-sm-10 ">
   					<button type="button" class="close">&times;</button>
   					LOADING!
  				</div>
  				<div class="alert alert-danger  alertHidden col-sm-10 ">
   					<button type="button" class="close">&times;</button>
   					ERROR!
  				</div>
			</div>

		</form>
		<div class="showDiv col-sm-offset-2"> 
			<span>爬虫过程详情-请点击</span>
			<button type="button" class="btn btn-info "   id="testbtn">进入</button>
		</div>
		
	</div>

	<script type="text/javascript">
		var currentId = 1,
			currentUrlId = 1,
			validateForm;
		$("#addAttr").click(addA);
		$("#cutAttr").click(cutA);
		$("#subBtn").click(sub);
		$("button.close").click(hideAlert);
		$("#testbtn").click(function() {
			self.location='loading.html'; 
		});
		$('#addUrl').click(addU);
		$('#cutUrl').click(cutU);


		$().ready(function() {
			validateForm = $("form.form-horizontal").validate({
				rules:{
				mainUrl:{
					required:true,					
				},
				attName0:"required",
				Xpath0:"required"
				},
				message:{

				},
				debug:true
			});
		});
		//添加元素
		function addA(){
			curName = "attName" + currentId; //属性ID
			curXpathName = "Xpath"+currentId;//XpathID
			var $add = '<div class="form-group"><label for="'+curName+'" class=" col-sm-2 control-label">ATTRIBUTE'+(currentId+1)+' NAME</label><div class="col-sm-2"><input type="text" name="'+curName+'" id="'+curName+'" class="form-control" placeholder="Please input the attribute"></div><label for="'+curXpathName+'" class="col-sm-1 control-label"> XPath'+(currentId+1)+' </label><div class="col-sm-5"><input type="text" name="'+curXpathName+'" id="'+curXpathName+'" class="form-control" placeholder="Please input the XPath"></div></div>';			
			$("#Btn").before($add);
			$("#"+curName).focus();
			currentId ++;
		}

		//删除元素
		function cutA(){
			var $cut = $("#Btn").prev();	//获取最后一个属性元素
			if(currentId > 1)  //至少保留一个属性
			{
				$cut.remove();
				currentId--;
			}

		}

		function hideAlert(){
			$(this).parent().hide('fast');
		}
		
		//提交表单
		function sub(){
			
			if(validateForm.form()) //如果表单符合要求
			{
				var postData = "{";
				var $message = $("input[type='text']");
				$message.each(function(index, el) {
					postData += '"'+$(el).attr('name')+'":"'+$(el).val()+'"';
					if(index != ( $message.length-1)) //如果不是最后一位才能添加逗号
						postData += ",";
				});
				 postData += "}";
				 $("#subBtn").addClass('disabled');
				 $('div.showDiv').show('400');
				console.log(postData);
				$.ajax({
					url: '/index',
					type: 'POST',
					dataType: 'json',
					data: postData,
					success:function(data){
						console.log(data);
						$("div.alert-success").show('400');
						self.location='loading.html'; 
					},
					error:function(data){	
						console.log(data);
						$("div.alert-danger").show('400');
						$('#subBtn').removeClass('disabled');
					}
				});
			}
		}
		/*<div class="form-group ">
				<label for="dataUrl" class=" col-sm-2 control-label"> THE DATA URL 1</label>
				<div class="col-sm-8">
					<input type="url" name="dataUrl" id="dataUrl" class="form-control" placeholder="Please input the URL">				
				</div>
			</div>*/
		//添加URl
		function addU(){
			currentUrlId ++;
			var div = document.createElement("div");
			$(div).addClass('form-group');
			var label = document.createElement("label");
			$(label).addClass('col-sm-2 control-label').text('THE DATA URL '+ currentUrlId);
			var div2 = document.createElement("div");
			$(div2).addClass('col-sm-8');
			var input = document.createElement("input");
			$(input).attr({
				name: 'dataUrl'+currentUrlId,
				type: 'text',
				placeholder:'Please input the URL'
			}).addClass('form-control');
			$(div2).append(input);
			$(div).append(label);
			$(div).append(div2);
			$("#Btn2").before(div);
		}
		function cutU(){
			if(currentUrlId<=1)
				return;
			var $cut = $("#Btn2").prev();
			$($cut).remove();
			currentUrlId--;
		}
	</script>
</body>
</html>